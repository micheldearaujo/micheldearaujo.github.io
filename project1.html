<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Discoverying Brazilian Real State in numbers</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="index.html">Michel de Araújo</a></h1>
<!--						<nav>-->
<!--							<a href="#menu">Menu</a>-->
<!--						</nav>-->
					</header>

				<!-- Menu -->
<!--					<nav id="menu">-->
<!--						<div class="inner">-->
<!--							<h2>Menu</h2>-->
<!--							<ul class="links">-->
<!--								<li><a href="index.html">Home</a></li>-->
<!--								<li><a href="generic.html">Generic</a></li>-->
<!--								<li><a href="elements.html">Elements</a></li>-->
<!--								<li><a href="#">Log In</a></li>-->
<!--								<li><a href="#">Sign Up</a></li>-->
<!--							</ul>-->
<!--							<a href="#" class="close">Close</a>-->
<!--						</div>-->
<!--					</nav>-->

				<!-- Wrapper -->
					<section id="wrapper">
						<header>
							<div class="inner">
								<h2>Analysis of rent prices distribution in Brazil</h2>
								<p>Discoverying Brazilian Real State in numbers.</p>
							</div>
						</header>

						<!-- Content -->
							<div class="wrapper">
								<div class="inner">

									<h2 class="major">Introduction</h2>
									<p>During my childhood, for various reasons, my family always had to move constantly. Today, at 23, I have moved 12 times and counting.
										It was practically once every two years. This lifestyle can have its upsides, such as always meeting new places, new people,
										new experiences and getting out of the box when discovering that the world is much more than it appears. However, always moving
										home brings with it some unwanted hassles, such as always spending money on furniture shipping, dealing with broken furniture in transportation,
										and finding good schools for the children (this part is quite difficult from my experience!). In addition to all of this, there is the difficult task of finding the perfect property,
										or at least close to perfection, that offers everything you are looking for combined with a fair price - the famous cost-benefit. Factors such as size, number of bedrooms, bathrooms,
										parking spaces and especially the location greatly affect the price of a house or apartment. At 22 I decided to leave my family's house and gather the rags with my girlfriend,
										and that's when I came across with all the difficulties and concerns that a child can't imagine. It was based on this that I decided to do this project, to get to know a little more
										about the Brazilian real estate market, not only from an economic point of view but from a practical point of view. Is it worth to rent a house with more space or is a studio apartment enough?
										Should I spend more living downtown near work where prices are higher and apartments are small, or should I spend less in a house further away? This is a very important decision to make,
										as it requires both physical and mental effort. This project is also suitable for those who have a property and want to rent it but have no idea how to price their house or apartment.
										It is possible to create a Machine Learning (ML) model to, through the data collected from properties throughout Brazil, determine, through the characteristics of your property, its rental price.</p>

									<p>This work will be constructed as follows: I will collect information about real estate via Webscraping using the Python programming language, together with the Selenium library, which allows me to
										browse web pages, interact with them and extract information. With the raw data, I will use the R language to perform all the data analysis: Cleaning, transformation, exploratory analysis and construction
										of the ML model to predict the price based on the houses characteristics. I thought that a good way to carry out this analysis would be to use a common site for renting and selling real estate, because there
										individuals and brokerages advertise their products. All the rest of the analysis will be done using the R language. You will probably need to do a good job of extracting data from strings, using regular expressions and splits.</p>

									<p>This analysis will be very useful for two different audiences. The first is people in general, who are looking for a new place to live and want to make an assertive decision based on real data. Through this analysis the user will be able
										to decide which type of property suits his needs, whether it is a house or apartment, whether it is near or far from the center, large or small, etc. The second audience is made up both of people in general, who own a property and
										wish to rent it but do not know how much it is worth, and for realtors, who technically do the same, but with third-party properties. This way, the client will be able to know more assertively what the value of his property should be
										based on hundreds of other properties with similar characteristics, from the same neighborhood and from nearby neighborhoods.</p>

									<h2 class="major">Necessary packages</h2>
									The following R packages will be necessary to develop this project:
									<pre><code>
library(dplyr) # String manipulation functions
library(readr) # Reading files and parse_number functions
library(stringr) # String manipulation
library(tidyr) # Data manipulation
library(DT) # Interactive tables
library(tidygeocoder) # Extract geographical informations from addresses
library(ggplot2) # Static graphics
library(plotly) # Interactive graphics
library(ggpubr) # Make subplots with ggplot2
require(nortest) # Anderson-DarlingHypothesis test
library(RColorBrewer) # More palette colors
library(rnaturalearth) # Getting sf maps
library(classInt) # Categorization of continuous variables</code></pre>
									<h2 class="major">Chapter 1: Data cleaning and transformation</h2>
									<p>All data were extracted via Webscraping from only one website, Zap Imóveis. This website allows one to filter between buying, renting, property type and location. The site presents different types of properties, such as apartment, studio, kitnet house, condominium house, village house, penthouse, flat, loft, land, and several other types of commercial establishments. In this project we will focus only on residential properties of the house and apartment type. The original purpose of the data is the commercialization of real estate, as it is a website where anyone can advertise their property for sale or rent. As the Webscraping process depends a lot on the internet speed, I collected all ads during the period from April to June. It may have taken longer than necessary, but I was still learning about the automation process and I certainly made some redundancies in the algorithm (for example, I had to go manually choosing geographic regions because it is only possible to filter up to 5 regions and the site do not makes all pages available without filtering.) The Webscraping process returns a string containing all the information of the ad in question, as can be seen in Figure 1. Thus,
									the original form of the dataframe has only one variable.However, more variables will be created during the transformation process.</p>

									<h3>Import and getting to know the data</h3>
									<p>Let's get to work! The first step is to import the data and visualize its structure.
									<pre><code>
anuncios <- read.csv('housing_prices.csv')
print('Dataframe structure: ')
str(anuncios)

# Result
## 'data.frame':    39912 obs. of  1 variable:
##  $ Anuncio: chr  "super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mê"| __truncated__ "apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomín"| __truncated__ "apartamento para alugar em\r\nCentro Histórico, Porto Alegre - RS\r\nR$ 700 /mês\r\ncondomínio R$ 220 IPTU R$ 3"| __truncated__ "apartamento para alugar em\r\nRua Marquês de Valença - Móoca, São Paulo - SP\r\nR$ 1.450 /mês\r\ncondomínio R$ "| __truncated__ ...
##  - attr(*, "spec")=
##   .. cols(
##   ..   Anuncio = col_character()
##   .. )
									</code></pre>
									Let us print a few lines to see how the ads are written:
									<pre><code>
head(anuncios,5)

## Anuncio
## 1  super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2  apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
## 3  apartamento para alugar em\r\nCentro Histórico, Porto Alegre - RS\r\nR$ 700 /mês\r\ncondomínio R$ 220 IPTU R$ 35 aluguel e condomínioR$ 920\r\n35 m²\r\n1 quarto\r\n2 banheiros
## 4  apartamento para alugar em\r\nRua Marquês de Valença - Móoca, São Paulo - SP\r\nR$ 1.450 /mês\r\ncondomínio R$ 850 IPTU não informado aluguel e condomínioR$ 2.300\r\n56 m²\r\n2 quartos\r\n1 vaga\r\n2 banheiros
## 5  apartamento para alugar em\r\nGleba Palhano, Londrina - PR\r\nR$ 950 /mês\r\ncondomínio R$ 280 IPTU não informado aluguel e condomínioR$ 1.230\r\n45 m²\r\n2 quartos\r\n1 vaga\r\n1 banheiro
									</code></pre>
									Therefore, what we have here is the raw text of 39912 houses and apartaments announcements in Brazil.
									The objective is to separate this lines breaks ("\r\n") into each characteristic of the property so we can study
									the problem and make conclusions about it.
									</p>
									<h3>Cleaning and transformation</h3>
									<p>
										First, it is important to understand why the cleaning and transformation steps are together.
										That is because the two processes will happen simultaneously, sometimes transforming,
										sometimes performing deleting some rows. The first step in cleaning and transforming is to
										create a column that tells you whether the property is a house (CS) or apartment (AP) type.
										For this I will use the <code>str_extract_all</code> function, from the <em>stringr</em> package.
									</p>

									<h4>The "Type" variable</h4>
									<p>
										<pre><code>
anuncios$Tipo <- unlist(str_extract_all(pattern = 'apartamento|casa|sobrado', string = anuncios$Anuncio))

## Error in `$<-.data.frame`(`*tmp*`, Tipo, value = c("apartamento", "apartamento", : replacement has 39764 rows, data has 39912
										</code></pre>
									An error was returned. It says that the quantity of items to add to the dataframe is less than the quantity of rows in the dataframe.
									This happened because not all ads specified whether it was a house or apartment or townhouse (which is a type of house). As the amount
									of ads without this information is relatively low (148 out of 39912 ads),
									I will remove the lines that do not have this information and then extract the “Type” information.
										<pre><code>
anuncios <- data.frame(Anuncio = anuncios[grepl(pattern = 'casa|apartamento|sobrado', x = anuncios$Anuncio), ])
anuncios$Tipo <- unlist(str_extract_all(pattern = 'apartamento|casa|sobrado', string = anuncios$Anuncio))
										</code></pre>
									The <code>grepl</code> function returns <code>TRUE</code> for a row when it matches the pattern and
									<code>FALSE</code> otherwise. Now, for simplicity, lets use initials instead of the full name,
									Where 'AP' stands for apartament and 'CS' stands for house.
										<pre><code>
anuncios$Tipo <- gsub(pattern='apartamento', replacement='AP', x=anuncios$Tipo)
anuncios$Tipo <- gsub(pattern='casa|sobrado', replacement='CS', x=anuncios$Tipo)
										</code></pre>
									Look at that, we have got our first information!
									</p>

									<h4 class="major">the "Price" variable</h4>
									<p>
									Next, let's extract the rental value from the property.
									To make the process easier, let's create a vector that contains all ads but separated in their line breaks, as follows
										<pre><code>
dados <- unlist(strsplit(x = anuncios$Anuncio, split='\n'))
head(dados, 10)

##  [1] "super destaque apartamento para alugar em\r"
##  [2] "Rua da República - Cidade Baixa, Porto Alegre - RS\r"
##  [3] "R$ 1.300 /mês\r"
##  [4] "condomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r"
##  [5] "61 m²\r"
##  [6] "1 quarto\r"
##  [7] "1 banheiro"
##  [8] "apartamento para alugar em\r"
##  [9] "Rua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r"
## [10] "R$ 1.500 /mês\r"
										</code></pre>
									Why create such a vector? The grep function returns only those elements of an array that have the established pattern.
									If I used grep in the ad column itself, it would return the entire row since it's a single string. By separating each ad into multiple vectors,
									through the line break, I get multiple lines, and only one line per ad contains the rental price. This way, when using grep, only the lines with the
									price will be returned.
									As each ad has only one piece of information of each type, this process will not change our data. So, we can extract the rent amount:
										<pre><code>
anuncios$Preco <- grep(pattern = '/mês', x = dados, value = TRUE)

## Error in `$<-.data.frame`(`*tmp*`, Preco, value = c("R$ 1.300 /mês\r", : replacement has 39123 rows, data has 39764
										</code></pre>
									Another error stating that the new column has fewer rows than the dataframe. Let's see what's going on.
										<pre><code>
head(data.frame(anuncios[!grepl(pattern = '/mês', x = anuncios$Anuncio), ]), 3)

##                                                                                                                                                                                                                   Anuncio
## 9   destaque apartamento para alugar em\r\nRua Augusto Severo Neto, 84 - Pirangi do Norte, Parnamirim - RN\r\nR$ 800 /dia\r\ncondomínio não informado IPTU não informado\r\n120 m²\r\n2 quartos\r\n2 vagas\r\n2 banheiros
## 65                                               apartamento para alugar em\r\nPrainha, Arraial do Cabo - RJ\r\nR$ 420 /dia\r\ncondomínio não informado IPTU não informado\r\n80 m²\r\n2 quartos\r\n1 vaga\r\n2 banheiros
## 143                             apartamento para alugar em\r\nQuadra Mar Centro, Balneário Camboriú - SC\r\nR$ 1.000 /dia\r\ncondomínio não informado IPTU não informado\r\n104 m²\r\n3 quartos\r\n2 vagas\r\n2 banheiros
##     Tipo
## 9     AP
## 65    AP
## 143   AP
										</code></pre>
									As can be seen, some advertisements inform the rental value using the word “Rent” and other advertisements are advertised dayily “/day”. As we are only interested in monthly rents, we will exclude daily rents.
										<pre><code>
anuncios <- data.frame(anuncios[grepl(pattern = 'Aluguel|/mês', x = anuncios$Anuncio), ])
										</code></pre>
									Note that after deleting some lines of the dataframe, it is necessary to redefine the "data" vector, which contains all the lines of the advertisements.
										<pre><code>
dados <- unlist(strsplit(x = anuncios$Anuncio, split = '\n'))
										</code></pre>
									Now it is possible to extract the "Price".
										<pre><code>
anuncios$Preco <- grep(pattern = '/mês|Aluguel', x = dados, value=TRUE)
head(anuncios, 2)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
##   Tipo           Preco
## 1   AP R$ 1.300 /mês\r
## 2   AP R$ 1.500 /mês\r
										</code></pre>
									Now we have the column with the prices. However, it is still necessary to carry out the cleaning and keep only the values. For this, I will use the parse_number function.
										<pre><code>
anuncios$Preco <- parse_number(x = anuncios$Preco, locale = locale(decimal_mark= ',' , grouping_mark = '.'))
head(anuncios, 2)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
##   Tipo Preco
## 1   AP  1300
## 2   AP  1500
										</code></pre>
									Now we have both the property type and its price!
									</p>

									<p>
									<h4 class="major">The "Area" variable</h4>
									The property size is a must have information when it comes to living confort and real state business.
									Note that all advertisements presents this information in the structure "number + m^2". Therefore,
										<pre><code>
anuncios$Area <- grep(pattern = '[0-9]+\\sm', x = dados, value = TRUE)
head(anuncios, 2)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
##   Tipo Preco    Area
## 1   AP  1300 61 m²\r
## 2   AP  1500 42 m²\r
										</code></pre>
									this time was not necessary dropping any rows. Lets clean it and extract only the numerical value
										<pre><code>
anuncios$Area <- parse_number(x=anuncios$Area, locale=locale(decimal_mark=',', grouping_mark='.'))
head(anuncios,2)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
##   Tipo Preco Area
## 1   AP  1300   61
## 2   AP  1500   42
										</code></pre>
									The dataframe is starting to take shape. But I still don't have all the information I need to carry out a study, so let's go ahead.
									</p>

									<h4 class="major">Bedroom numbers</h4>
									<p>
										The next piece of information Were are going to extract is the number of rooms. It probably is not going to present any difficulties.
										<pre><code>
anuncios$Quartos <- grep(pattern='quartos?', x=dados, value=TRUE)

## Error in `$<-.data.frame`(`*tmp*`, Quartos, value = c("1 quarto\r", "2 quartos\r", : replacement has 39176 rows, data has 39189
										</code></pre>
										Apparently it was wrong. I'll remove the ads that didn't inform the number of rooms, extract the information and clear the column, leaving only the values.
										<pre><code>
anuncios <- data.frame(anuncios[grepl(pattern='quartos?', x=anuncios$Anuncio), ]) # Filtering the dataframe.
anuncios$Quartos <- grep(pattern='quartos?', x=dados, value=TRUE) # Extracting the number of rooms.
anuncios$Quartos <- parse_number(x=anuncios$Quartos, locale=locale(decimal_mark=',', grouping_mark='.')) # Extracting only the numerical value.
head(anuncios)

##                                                                                                                                                                                                             Anuncio
## 1  super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2              apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
## 3                                   apartamento para alugar em\r\nCentro Histórico, Porto Alegre - RS\r\nR$ 700 /mês\r\ncondomínio R$ 220 IPTU R$ 35 aluguel e condomínioR$ 920\r\n35 m²\r\n1 quarto\r\n2 banheiros
## 4 apartamento para alugar em\r\nRua Marquês de Valença - Móoca, São Paulo - SP\r\nR$ 1.450 /mês\r\ncondomínio R$ 850 IPTU não informado aluguel e condomínioR$ 2.300\r\n56 m²\r\n2 quartos\r\n1 vaga\r\n2 banheiros
## 5                      apartamento para alugar em\r\nGleba Palhano, Londrina - PR\r\nR$ 950 /mês\r\ncondomínio R$ 280 IPTU não informado aluguel e condomínioR$ 1.230\r\n45 m²\r\n2 quartos\r\n1 vaga\r\n1 banheiro
## 6               apartamento para alugar em\r\nJardim São Dimas, São José dos Campos - SP\r\nR$ 1.150 /mês\r\ncondomínio R$ 450 IPTU R$ 45 aluguel e condomínioR$ 1.600\r\n45 m²\r\n1 quarto\r\n1 vaga\r\n1 banheiro
##   Tipo Preco Area Quartos
## 1   AP  1300   61       1
## 2   AP  1500   42       2
## 3   AP   700   35       1
## 4   AP  1450   56       2
## 5   AP   950   45       2
## 6   AP  1150   45       1
										</code></pre>
										Remembering that as I deleted lines from the dataframe, it is necessary to update the data vector.
										<pre><code>
dados <- unlist(strsplit(x=anuncios$Anuncio, split='\n'))
										</code></pre>
									</p>

									<h4 class="major">Bathrooms number</h4>
									<p>
										Well, until here there is nothing new.
										<pre><code>
anuncios <- data.frame(anuncios[grepl(pattern='banheiros?', x=anuncios$Anuncio), ])
anuncios$Banheiros <- grep(pattern='banheiros?', x=dados, value=T)
anuncios$Banheiros <- parse_number(x=anuncios$Banheiros, locale=locale(decimal_mark=',', grouping_mark='.'))
dados <- unlist(strsplit(x=anuncios$Anuncio, split='\n'))
										</code></pre>
									</p>

									<h4 class="major">The "Endereco" variable</h4>
									<p>
										Finally, it was time to extract the property address. Note that addresses always have a hyphen in their text and no
										other information has a hyphen, so I'll use this to my advantage.
										As the address is a very important feature of the property, it is unlikely that this information is missing from any of them.
										<pre><code>
anuncios$Endereco <- grep(pattern='-', x=dados, value=TRUE)
head(anuncios, 2)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
##   Tipo Preco Area Quartos Banheiros
## 1   AP  1300   61       1         1
## 2   AP  1500   42       2         1
##                                                 Endereco
## 1   Rua da República - Cidade Baixa, Porto Alegre - RS\r
## 2 Rua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r
										</code></pre>
										Now we have the complete adress of each property. But we need less specific information, like city and state. So, lets get it.
									</p>


									<h4 class="major">The "Estado" Variable</h4>
									<p>
										Note that the end of each string in the address column ends with the state, written by an acronym. Therefore, I will use pattern='[A-Z]{2}$.
										<pre><code>
anuncios$Estado <- unlist(str_extract_all(pattern='[A-Z]{2}$', string=anuncios$Endereco))
head(anuncios,3)

##                                                                                                                                                                                                            Anuncio
## 1 super destaque apartamento para alugar em\r\nRua da República - Cidade Baixa, Porto Alegre - RS\r\nR$ 1.300 /mês\r\ncondomínio R$ 516 IPTU R$ 53 aluguel e condomínioR$ 1.816\r\n61 m²\r\n1 quarto\r\n1 banheiro
## 2             apartamento para alugar em\r\nRua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r\nR$ 1.500 /mês\r\ncondomínio R$ 100 IPTU R$ 32 aluguel e condomínioR$ 1.600\r\n42 m²\r\n2 quartos\r\n1 banheiro
## 3                                  apartamento para alugar em\r\nCentro Histórico, Porto Alegre - RS\r\nR$ 700 /mês\r\ncondomínio R$ 220 IPTU R$ 35 aluguel e condomínioR$ 920\r\n35 m²\r\n1 quarto\r\n2 banheiros
##   Tipo Preco Area Quartos Banheiros
## 1   AP  1300   61       1         1
## 2   AP  1500   42       2         1
## 3   AP   700   35       1         2
##                                                 Endereco Estado
## 1   Rua da República - Cidade Baixa, Porto Alegre - RS\r     RS
## 2 Rua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r     SP
## 3                  Centro Histórico, Porto Alegre - RS\r     RS
										</code></pre>
										Perfect! That was easy.
									</p>

									<h4 class="major">The "Cidade" variable</h4>
									<p>
										This part is a bit more complicated. At first, I could define the pattern as ',\\s.*\\s-':
										<pre><code>
anuncios$Cidade <- unlist(str_extract_all(pattern=',\\s.*\\s-', string=anuncios$Endereco))

## Error in `$<-.data.frame`(`*tmp*`, Cidade, value = c(", Porto Alegre -", : replacement has 39115 rows, data has 39164
										</code></pre>
										Some lines does not carries the city name, so i will remove those.
										<pre><code>
anuncios <- data.frame(anuncios[grepl(pattern=',\\s.*\\s-', x=anuncios$Endereco), ])
dados <- unlist(strsplit(x=anuncios$Anuncio, split='\n'))
anuncios$Cidade <- unlist(str_extract_all(pattern=',\\s.*\\s-', string=anuncios$Endereco))
head(anuncios[3:7,7])

## [1] "Centro Histórico, Porto Alegre - RS\r"
## [2] "Rua Marquês de Valença - Móoca, São Paulo - SP\r"
## [3] "Gleba Palhano, Londrina - PR\r"
## [4] "Jardim São Dimas, São José dos Campos - SP\r"
## [5] "Rua Doutor Quirino, 533 - Centro, Campinas - SP\r"
										</code></pre>
									</p>

									<h4 class="major">Geolocalization</h4>
									<p>
										What I'm going to do now is use the geocode function from the tidygeocoder library to extract latitude and longitude information from property addresses.
										The purpose of this is to look at the dataset from a geographic point of view and learn how properties behave according to the regions of Brazil. This function receives as input a dataframe and a specific column of this dataframe, which is where the addresses are.
										Before that, I'll add Brazil to the end of all addresses, so that no location from another country that also speaks Portuguese is returned.
										<pre><code>
anuncios$Endereco <- paste(anuncios$Endereco, 'Brazil', sep=', ')
anuncios <- geocode(.tbl=anuncios, address='Endereco')
										</code></pre>
										Ufa! Chegamos ao final da extração das informações. Para finalizar esta etapa de limpeza, vamos excluir as linhas repetidas e selecionar o dataframe sem a coluna “Anuncio”.
										<pre><code>
anuncios <- anuncios[!duplicated(anuncios),] # Remove as duplicatas
anuncios <- select(anuncios, -Anuncio) # Exclui a coluna "Anuncio"
head(anuncios, 10)

##    Tipo Preco Area Quartos Banheiros
## 1    AP  1300   61       1         1
## 2    AP  1500   42       2         1
## 3    AP   700   35       1         2
## 4    AP  1450   56       2         2
## 5    AP   950   45       2         1
## 6    AP  1150   45       1         1
## 7    AP   600   73       1         2
## 8    AP  1500   49       2         1
## 10   AP  1400   70       2         1
## 11   AP  1300  103       2         2
##                                                          Endereco Estado
## 1    Rua da República - Cidade Baixa, Porto Alegre - RS\r, Brazil     RS
## 2  Rua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r, Brazil     SP
## 3                   Centro Histórico, Porto Alegre - RS\r, Brazil     RS
## 4        Rua Marquês de Valença - Móoca, São Paulo - SP\r, Brazil     SP
## 5                          Gleba Palhano, Londrina - PR\r, Brazil     PR
## 6            Jardim São Dimas, São José dos Campos - SP\r, Brazil     SP
## 7       Rua Doutor Quirino, 533 - Centro, Campinas - SP\r, Brazil     SP
## 8               Jardim Flor da Montanha, Guarulhos - SP\r, Brazil     SP
## 10      Rua César Lombroso - Bom Fim, Porto Alegre - RS\r, Brazil     RS
## 11               Jardim Anhanguéra, Ribeirão Preto - SP\r, Brazil     SP
##                 Cidade
## 1         Porto Alegre
## 2            São Paulo
## 3         Porto Alegre
## 4            São Paulo
## 5             Londrina
## 6  São José dos Campos
## 7             Campinas
## 8            Guarulhos
## 10        Porto Alegre
## 11      Ribeirão Preto
										</code></pre>
										And the structure:
										<pre><code>
## 'data.frame':    25475 obs. of  8 variables:
##  $ Tipo     : chr  "AP" "AP" "AP" "AP" ...
##  $ Preco    : num  1300 1500 700 1450 950 1150 600 1500 1400 1300 ...
##  $ Area     : num  61 42 35 56 45 45 73 49 70 103 ...
##  $ Quartos  : num  1 2 1 2 2 1 1 2 2 2 ...
##  $ Banheiros: num  1 1 2 2 1 1 2 1 1 2 ...
##  $ Endereco : chr  "Rua da República - Cidade Baixa, Porto Alegre - RS\r, Brazil" "Rua Cônego Ladeira, 57 - Vila Mazzei, São Paulo - SP\r, Brazil" "Centro Histórico, Porto Alegre - RS\r, Brazil" "Rua Marquês de Valença - Móoca, São Paulo - SP\r, Brazil" ...
##  $ Estado   : chr  "RS" "SP" "RS" "SP" ...
##  $ Cidade   : chr  "Porto Alegre" "São Paulo" "Porto Alegre" "São Paulo" ...
										</code></pre>
										As can be seen, the number of lines has been greatly reduced due to the amount of repeated ads.
									This duplication may have occurred both at the time of data collection, in which the program went through the same link more than once,
									or by part of the website, which may have repeated ads. I will export the .csv file to save the progress.
										<pre><code>
write.csv(anuncios, 'imoveis.csv', row.names = FALSE)
										</code></pre>
									</p>


									<h4 class="major">Summary</h4>
									<p>
										We have reached the end of the dataset cleanup and transformation step. In the beginning it was just a string column,
										in which each line was a complete listing of a property taken from the Zap Imoveis website. At the end we have a dataframe with 8 columns,
										each of which represents different information about the establishment.
										The following table provides a brief description of what each column represents.

										<h4>Dataset variables summary</h4>
										<div class="table-wrapper">
											<table class="alt">
												<thead>
													<tr>
														<th>Variable</th>
														<th>Type</th>
														<th>Description</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>Type</td>
														<td>Character</td>
														<td>Property type (house or apartament).</td>
													</tr>
													<tr>
														<td>Preco</td>
														<td>Numeric</td>
														<td>Monthly cost of the property.</td>
													</tr>
													<tr>
														<td>Area</td>
														<td>Numeric</td>
														<td>Value, in squared meters, of the property.</td>
													</tr>
													<tr>
														<td>Bedrooms</td>
														<td>Numeric</td>
														<td>Quantity of bedrooms in the property.</td>
													</tr>
													<tr>
														<td>Bathrooms</td>
														<td>Numeric</td>
														<td>Quantity of bathrooms in the property.</td>
													</tr>
													<tr>
														<td>Address</td>
														<td>Character</td>
														<td>Full address of the property.</td>
													</tr>
													<tr>
														<td>State</td>
														<td>Character.</td>
														<td>Brazilian state in which the property is.</td>
													</tr>
													<tr>
														<td>City</td>
														<td>Character.</td>
														<td>Brazilian city in which the property is.</td>
													</tr>
													<tr>
														<td>lat</td>
														<td>Numeric.</td>
														<td>The property Latitude (geographical coordinate).</td>
													</tr>
													<tr>
														<td>long</td>
														<td>Numeric.</td>
														<td>The property Longitude (geographical coordinate).</td>
													</tr>
												</tbody>
											</table>
										</div>
									</p>


									<h2 class="major">Chapter 2: Exploratory Data Analysis</h2>
									<p>
										Welcome to the second part of this project. EDA, “Exploratory Data Analysis”, refers to the initial investigation stage conducted on the data cleaned
										in the preparation stage. The objective here is, as the name implies, to explore. Knowing the data to know not only what happened in the past but also
										knowing how to explain what and how a given phenomenon happened and what to do if it happens again - so-called descriptive and diagnostic analysis,
										are two main characteristics of an exploratory analysis (EA ). At this point, let's not worry about trying to use the data to predict the future.
										We just want insights into what happened and what is happening. Contextualized with the business world, AE is directly related to BI
										(Business Intelligence). BI is precisely concerned with relying on scientific information (the data) in order to make business decisions.
										Companies that follow this “philosophy” are known as Data Driven companies. As such, I will now conduct an AE on the cleaned and transformed
										data in the previous section.
									</p>

									<h3 class="major">Inital Exploration</h3>
									<p>
										I start by importing the imoveis.csv file that I saved at the end of the last section.
										<pre><code>
anuncios <- read_csv('imoveis.csv', locale=locale(encoding='latin1'))
head(anuncios, 5)

## # A tibble: 5 x 10
##   Tipo  Preco  Area Quartos Banheiros Endereco         Estado Cidade   lat  long
##   <chr> <dbl> <dbl>   <dbl>     <dbl> <chr>            <chr>  <chr>  <dbl> <dbl>
## 1 AP     1300    61       1         1 "Rua da Repúbli~ RS     Porto~ -30.0 -51.2
## 2 AP     1500    42       2         1 "Rua Cônego Lad~ SP     São P~ -23.5 -46.6
## 3 AP      700    35       1         2 "Centro Históri~ RS     Porto~ -30.0 -51.2
## 4 AP     1450    56       2         2 "Rua Marquês de~ SP     São P~ -23.6 -46.6
## 5 AP      950    45       2         1 "Gleba Palhano,~ PR     Londr~  NA    NA
										</code></pre>

											How will property prices be distributed? How much do you think the maximum rental price is? Let's figure this out using a simple histogram.

										<pre><code>
options(scipen=999)
hist <- plot_ly(data=anuncios,
                type='histogram') %>%
  add_trace(x=~Preco,
            name='Preço') %>%
            layout(title='Distribuição dos preços',
                   xaxis=list(title='Preço'),
                   yaxis=list(title='Frequência'))
hist
										</code></pre>
									<h4 class="major">FIRST HISTOGRAM HERE</h4>
										Wow! We have outliers reaching up to R$1 million! This is okay if it was the sale value, but R$ 1 million monthly?
										It seems a little absurd! We can further investigate the variable distribution and outliers using a boxplot plot.
										The boxplot is a graph that provides important information about the statistics of the variable in analysis, such as median,
										first and third quartile, maximum, minimum and outliers.
									<pre><code>
plot_ly(data=anuncios,
        type='box') %>%
  add_trace(y=~Preco,
            name='Preço')
									</code></pre>
										Alright, apparently there are a lot of outliers in this dataset. Shall we verify if the same happens with the "Area" Variable.
									<pre><code>
plot_ly(data=anuncios,
        type='box') %>%
  add_trace(y=~Area,
            name='Área (m²)')
									</code></pre>
										Unfortunately the result is similar. We have a property with more than 450,000 square meters (maybe it's a farm or something like that).
										So I will follow our boxplots and remove the outliers from our dataset. The price variable will have a maximum of 5 thousand reais and the
										Area variable will have its upper limit of 200 square meters. It is possible to extract the boxplot function's outliers through the "out"
										column and then do a logical indexing to create a new dataframe without them.
									<pre><code>
# Removing outliers
anunciosf <- anuncios[-which(anuncios$Preco %in% boxplot(anuncios$Preco, plot=F)$out),] # Outliers from Preco
anunciosf <- anunciosf[-which(anunciosf$Area %in% boxplot(anunciosf$Area, plot=F)$out),] # Outliers from Area
									</code></pre>
										Now let's rerun the graphs and see better how the Price and Area variables are distributed.
									<pre><code>
hist1 <- plot_ly(data=anunciosf,
                 type='histogram',
                 colors=c('orange')) %>%
  add_trace(name='Preço',
                 x=~Preco,
                 color=I('orange'),
                xbins=10) %>%
  layout(title='Distribuição dos preços dos imóveis (sem outliers)',
  xaxis=list(title='Preço'),
  yaxis=list(title='Frequência'))

bx1 <- plot_ly(data=anunciosf,
        type='box',
        colors=c('blue', 'orange')) %>%
  add_trace(y=~Preco,
            name='Preço',
            color=I('orange')) %>%
  layout(title='Distribuição dos preços dos imóveis (sem outliers)')

bx2 <- plot_ly(data=anunciosf,
        type='box') %>%
  add_trace(y=~Area,
            name='Área',
            color=I('steelblue')) %>%
  layout(title='Distribuição dos preços dos imóveis (sem outliers)')

fig1 <- subplot(hist1, bx1, bx2, widths = c(0.4, 0.3, 0.3), nrows=1)
fig1
									</code></pre>
										Much better! Now the data has a more user-friendly distribution. Note that when filtering the dataset,
										new outliers appear. But let's not worry about them that much, otherwise we run the risk of getting into a loop.
										Let us turn our attention to the relationship between Price and Area. It is to be expected that the larger a property,
										the more expensive it is. We'll also look at how this relationship varies by property type. For that, I'll do a scatterplot
										depending on the Type.
									<pre><code>
plot_ly(data=anunciosf,
        type='scatter',
        x=~Area,
        y=~Preco,
        color=~Tipo,
        colors=c('orange', 'steelblue'),
        marker = list(size=7),
        mode='markers') %>%
  layout(title='Relação entre Área e Preço do imóvel',
         xaxis=list(title='Área (m²)'),
         yaxis=list(title='Preço'))
									</code></pre>
									<h4 class="major">SCATTERPLOT 1 HERE</h4>
										The relationship between price and area is not as linear as we thought. Also note that there are sets of points aligned
										vertically at the same value. Can you explain why? I will come back to this later. Visually, it is also possible to see that
										apartment prices reach higher values ​​than houses when the area is less than 100 square meters. In addition, after this
										value, one begins to notice a decrease in the number of apartments. This must happen due to the spatial limitation that the
										apartments are submitted to. However, fixing the area at 200 square meters, the price varies from 250 to 5000. What can cause
										this price variation for properties of the same size? It was with this in mind that I collected the geographic information
										from the residences! Location is a decisive factor in pricing a property.

										Now it remains to verify how the rental price varies according to the other numerical variables quantity of rooms and bathrooms.
										The graph below shows the relationship between price and rooms and, on the right, the relationship between price and bathrooms.

									<pre><code>
sct1 <- plot_ly(data=anunciosf,
        type='scatter',
        x=~Quartos,
        y=~Preco,
        color=~Tipo,
        colors=c('orange', 'steelblue'),
        marker = list(size=7),
        mode='markers') %>%
  layout(title='Preço do imóvel versus quantidade de quartos',
         xaxis=list(title='Quartos', autotick=FALSE, tick0=0, dtick=1),
         yaxis=list(title='Preço'))

sct2 <- plot_ly(data=anunciosf,
        type='scatter',
        x=~Banheiros,
        y=~Preco,
        color=~Tipo,
        colors=c('orange', 'steelblue'),
        marker = list(size=7),
        mode='markers',
        showlegend=F) %>%
  layout(title='Preço do imóvel versus quantidade de banheiros',
         xaxis=list(title='Banheiros', autotick=FALSE, tick0=0, dtick=1),
         yaxis=list(title='Preço'))

fig2 <- subplot(sct1, sct2, titleX = T, titleY=T, shareY=T, which_layout = c(1,2))
fig2
									</code></pre>
									<h4 class="major">SCATTERPLOT 2 HERE</h4>
										Returning to my question about the vertical lines, they represent precisely the properties with equal values of bedrooms and bathrooms.
										It seems that these two variables tell us little about pricing.
										We can verify this by running a Pearson correlation test.
									<pre><code>
anunciosf <- anunciosf[!is.na(anunciosf$Preco),]
pversusq <- cor(x=anunciosf$Preco, y=anunciosf$Quartos)
pversusb <- cor(x=anunciosf$Preco, y=anunciosf$Banheiros)
paste("O coeficiente de correlação Pearson entre Preco e Quartos é", pversusq)
paste("O coeficiente de correlação Pearson entre Preco e Banheiros é", pversusb)

## [1] "O coeficiente de correlação Pearson entre Preco e Quartos é 0.26036535879529"
## [1] "O coeficiente de correlação Pearson entre Preco e Banheiros é 0.418361998820095"
									</code></pre>
										Both coefficients are relatively weak, as would be expected from the analysis of the graph. We can conclude so far that the
									pricing of homes goes beyond the total size and number of rooms. Some other features, which are not in our dataset, can contribute
									to the appreciation (or depreciation) of a property, such as foundation (if the house is designed to receive 1 or more upper floors),
									type of floor (cement, porcelain or flooring vinyl), roofing (slab or roof), year of construction, among others.
									</p>

									<h4 class="major">Is there a relevant difference between the prices of houses and apartments?</h4>
									<p>
										Let's turn our attention now to the controversy that says that apartments are cheaper than houses, when compared to properties of the same dimensions.
										Is this really true? As we've seen, pricing can be quite complex, so for study purposes, let's run a hypothesis test to find out if the difference
										between average house and apartment prices is statistically relevant. It is possible to get a sense of the differences in price averages by viewing
										the boxplots of the variable as a function of the variable Type:
										<pre><code>
bx3 <- plot_ly(data=anunciosf,
               color=~Tipo) %>%
  add_boxplot(y=~Preco) %>%
  layout(title='Distribuição dos preços dos imóveis')
bx3
										</code></pre>
									<h4 class="major">BOX PLOT 3 HERE</h4>
										The two classes have very similar values! We could conclude here the verification of the hypotheses, but in the first scatter plot we observe that,
										for a number of small rooms, the values of apartments are higher than those of houses. Thus, let's rerun these boxplots considering the number of rooms
										equal to 1.
										<pre><code>
bx3 <- plot_ly(data=filter(anunciosf, Quartos==1),
               color=~Tipo) %>%
  add_boxplot(y=~Preco) %>%
  layout(title='Distribuição dos preços dos imóveis')
bx3
										</code></pre>
									<h4 class="major">BOX PLOT 3 HERE</h4>
										You can now see a significant difference! House prices have a much smaller variance than apartment prices. Therefore, it is worth performing a hypothesis
										test to verify whether, for 1 quart, there is a significant difference between these means.
										Before starting the hypothesis test, it is necessary to know the type of distribution of the variables. For this, let us consider the histograms:
										<pre><code>
# Verificando a normalidade pelo histograma
hist2 <- plot_ly(data=anunciosf,color=~Tipo, nbinsx=20) %>%
  add_histogram(x=~Preco) %>%
  layout(xaxis=list(title='Preço', tick0=0, autotick=F, dtick=500),
         yaxis=list(title='Frequência'),
         title='Verificando a Normalidade do Preço')
hist2
										</code></pre>
									<h4 class="major">HISTOGRAM 2 HERE</h4>
										<pre><code>
# Verificando a normalidade pelo QQ-plot
qqnorm(anunciosf$Preco, main='QQ plot da variável Preço', pch=18)
qqline(anunciosf$Preco)
										</code></pre>

									<h4 class="major">QQPLOT HERE</h4>
										We can conclude that the price does not follow a Normal distribution. It's even more like a Poisson distribution. To finalize the verification,
										we used the Anderson-Darling test, considering that the sample size is greater than 51. Here are the hypotheses:
										H0:A variável Preco segue distribuição Normal
										H1:A variável Preco não segue distribuição Normal
										<pre><code>
ad.test(anunciosf$Preco)

##
##  Anderson-Darling normality test
##
## data:  anunciosf$Preco
## A = 588.06, p-value < 0.00000000000000022
										</code></pre>
										Independentemente do nível de confiança, a distribuição definitivamente não é Normal! Pensando nisto, precisamos ou realizar
										testes não parámetricos ou transformar a distrição original em uma distribuição Normal utilizando o Teorema Central do Limite (TCL).
										Vamos usar a segunda opção.
										Dessa forma, as hipóteses são:
										H0:Não existe diferença entre os preços de casas e apartamentos
										H1:Existe diferença entre os preços de casas e apartamentos
										<pre><code>
n.amostras <- 1000
tam.amostra <- 100
medias.ap <- vector()
medias.cs <- vector()
for (i in 1:n.amostras){
  medias.ap[i] <- mean(sample(filter(anunciosf, Tipo=='CS' & Quartos==1)$Preco, size=tam.amostra, replace=T))
  medias.cs[i] <- mean(sample(filter(anunciosf, Tipo=='AP' & Quartos==1)$Preco, size=tam.amostra, replace=T))
}
hist(medias.ap)
										</code></pre>


									</p>

									<h3 class="major">Summary</h3>
									<p>
										To finish this first part of the EDA, let's summarize some of the information seen so far.
										<h4>Dataset numerical variables summary</h4>
										<div class="table-wrapper">
											<table class="alt">
												<thead>
													<tr>
														<th>Type</th>
														<th>Count</th>
														<th>Mean.Price</th>
														<th>Standard.Dev.Price</th>
														<th>Mean.Bedrooms</th>
														<th>Mean.Bathrooms</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>AP</td>
														<td>16170</td>
														<td>1661.71</td>
														<td>947.62</td>
														<td>2.09</td>
														<td>1.62</td>
													</tr>
													<tr>
														<td>CS</td>
														<td>5588</td>
														<td>1611.81</td>
														<td>930.96</td>
														<td>2.29</td>
														<td>1.62</td>
													</tr>
													<tr>
												</tbody>
											</table>
										</div>

										In addition to the numerical discoveries, we have
												<ol>
													<li>Number of bedrooms and bathrooms alone say little about the pricing of a property.</li>
													<li>There is no statistical difference between the prices of houses and apartments.</li>
												</ol>
									</p>

									<h2 class="major">Chapter 3: Geoespacial Analysis</h2>
									<h3 class="major">In this section we'll explore how location affects the pricing of a property.</h3>
									<p>
										In the search for the perfect home, location plays a major role in the process of choosing a new living place.
										Issues such as proximity to bakeries, schools, universities, leisure centers, beach, public transport integrations,
										among others, arise and we must make the decision based both on our needs and our personallity. There are those who
										like the bustle of the urban center and living close to work. Other people prefer to live further away, isolated from
										the noise and rush of everyday life. Each of these alternatives leads to different choices. Choices that bring with them
										their negative points, such as transportation expenses, for those who live far from work, and high rent costs, for those
										who live downtown. In this section we will explore how property prices vary across the Brazilian territory. Find out the
										averages, maximums and minimums for each state and how these values relate to the average state income and quality
										of life.

										To start, let's look again at the appearance of our dataframe in relation to the columns with geographic information.
										<pre><code>
head(select(anunciosf, -c(1:5)), 5)

## # A tibble: 5 x 5
##   Endereco                                         Estado Cidade       lat  long
##   <chr>                                            <chr>  <chr>      <dbl> <dbl>
## 1 "Rua da República - Cidade Baixa, Porto Alegre ~ RS     Porto Ale~ -30.0 -51.2
## 2 "Rua Cônego Ladeira, 57 - Vila Mazzei, São Paul~ SP     São Paulo  -23.5 -46.6
## 3 "Centro Histórico, Porto Alegre - RS\r, Brazil"  RS     Porto Ale~ -30.0 -51.2
## 4 "Rua Marquês de Valença - Móoca, São Paulo - SP~ SP     São Paulo  -23.6 -46.6
## 5 "Gleba Palhano, Londrina - PR\r, Brazil"         PR     Londrina    NA    NA
										</code></pre>
										There are several rows, in the lat and long columns, with NA values. This happened because not all addresses were found by the geocode function.
										Let's remove these lines and work only with the ones that have the full coordinates.
										<pre><code>
anunciosf <- data.frame(drop_na(anunciosf))
										</code></pre>
										Unfortunately we missed a good number of observations. To start with, let's find the average price and how many observations were recorded per state. We can observe this through a table:
										<pre><code>
by_state1 <- anunciosf %>%
  group_by(Estado) %>%
  summarise(Quantidade=n(),
            MediaPreco = round(mean(Preco),2)) %>%
  arrange(desc(Quantidade, MediaPreco))
datatable(data=by_state1, caption='Número de observações e média por estado')
										</code></pre>
									<h4 class="major">STATES TABLE HERE</h4>
										It is notable that São Paulo occupies a lot of space on real estate websites. There is a large imbalance in the geographic proportion
										of this dataset. This can (and should) be corrected with a new data collection focused on states with fewer observations.
										In addition to the table, with a bar chart we can better visualize the averages by state and property type:
										<pre><code>
by_state2 <- anunciosf %>%
  group_by(Estado, Tipo) %>%
  summarise(Quantidade=n(),
            MediaPreco = mean(Preco)) %>%
  arrange(MediaPreco)

bar1 <- plot_ly(data=by_state2,
                type='bar',
                color=~Tipo) %>%
  add_trace(x=~Estado, y=~MediaPreco)

bar1
										</code></pre>
									<h4 class="major">BARPLOT 1 HERE</h4>

										It is also possible to note that some states do not have any observations regarding houses, and that there are no observations regarding the states of Acre, Amapá, Rondônia, Roraima and Amazonas.

										To finish this part, we can look at the relationship between the average of rent values and the average wages by state. This information is relevant because, someone may feel excited to move to São Paulo because the salaries are higher,
										but when they get there they face higher rents and cost of living than before. I couldn't find this information on the IBGE
										(Brazilian Institute of Geography and Statistics) website, which is the official body responsible for data collection, so I
										will use a survey carried out by the company Catho, which operates in the field of statistical research.
										<pre><code>
# Lendo o arquivo que contém a média salarial por estado
salarios <- read.csv('salarios.csv', sep=';')
names(salarios)[2] <- 'MediaSalario'
head(salarios, 5)

##   Estado MediaSalario
## 1     SP  R$ 2.760,94
## 2     DF  R$ 2.529,17
## 3     RJ  R$ 2.487,28
## 4     SC  R$ 2.355,82
## 5     PR  R$ 2.293,35
										</code></pre>
										Now we need to join the two dataframes together. We can do this using the <i>merge</i> function.
										<pre><code>
anunciosg <- merge(x=by_state1,
                   y=salarios,
                   by='Estado')

anunciosg$MediaSalario <- parse_number(anunciosg$MediaSalario, locale=locale(decimal_mark=',', grouping_mark = '.'))
										</code></pre>
										And finally, we create a vector that shows the ratio between the average salary and the average rental cost per state.
										<pre><code>
anunciosg <- arrange(anunciosg, MediaPreco)
anunciosg <- mutate(anunciosg, Proporcao = anunciosg$MediaPreco/anunciosg$MediaSalario)

bar2 <- plot_ly(data=anunciosg, type='bar',
                orientation='h',
                color=~Proporcao,
                colors=) %>%
  add_trace(y=~Estado,
            x=~MediaPreco) %>%
  add_annotations(xref=anunciosg$MediaPreco, yref=anunciosg$Estado,
                  y=anunciosg$Estado, x= anunciosg$MediaPreco*1 + 200,
                  text=paste(round(anunciosg$Proporcao, 2)*100, '%'),
                  showarrow=F) %>%
  layout(title='Proporção entre salário médio e valor médio de aluguel',
  xaxis=list(title='Valor Aluguel'),
  yaxis=list(title='Estado'))
bar2
										</code></pre>
									<h4 class="major">BARPLOT 2 HERE</h4>
										As can be seen, in some Brazilian states the average price of a residential rental is higher than the average salary itself:
										<pre><code>
Acima_da_Media <- filter(anunciosg, Proporcao>1)[-2]
Acima_da_Media

##   Estado MediaPreco MediaSalario Proporcao
## 1     PB    1787.26      1750.84  1.020801
## 2     AL    2030.41      1807.32  1.123437
## 3     PA    2075.00      2061.45  1.006573
## 4     PE    2108.35      1908.52  1.104704
## 5     ES    2522.22      2125.70  1.186536
## 6     TO    2850.00      1968.34  1.447921
										</code></pre>
									</p>

									<h3 class="major">Maps</h3>
									<p>
										A third way to analyze our data, in addition to the graphs and tables previously explored, is through maps. Maps can be very useful at this point as
										they bring a sense of space and distance that are absent in previous indicators. Furthermore, it is also possible to better understand the distribution
										of residences in the regions of each state. Do you think there are more properties listed on the site coming from the capitals or the countryside?
										To start with, we need to use a special type of variable. Note that our dataframe already has two columns with the longitudes and latitudes of the homes.
										However, in order for us to locate these points on a map it is necessary to transform them into the <code>sf</code> (single feature) format. This manipulation can be
										done through the function <code>st_as_sf</code>, which transforms a dataframe that has columns with latitudes and longitudes into a dataframe of type <code>sf</code>, with a column
										called <code>geometry</code>. This column has data in <code>point</code> format, in the form (long, lat). In addition, we will use the ne_states function from the <i>rnaturalearth</i> library
										to download the map of Brazil, which will also be stored in an object of type <code>sf</code>. To start with, we can plot all homes that have a full address on the map of
										Brazil using the function using the <i>ggplot2</i> library.
										<pre><code>
# Transforming the regular dataframe into a sf dataframe
pontos_sf <- st_as_sf(anunciosf, coords=c('long','lat'), crs=4326)

# Download the brazilian map
estados_sf <- ne_states(country='brazil', returnclas='sf')

mapa <- ggplot() +
  geom_sf(data=estados_sf,
          fill=gray(0.85), color=gray(0.7)) +
  labs(title='Mapa do Brasil')
mapa
										</code></pre>
										<h4 class="major">BRAZIL MAP 1 HERE</h4>

									Now we can add points to the map through the new <i>geometry</i> column, from the points_sf dataframe, which was added to the dataframe.
										<pre><code>
mapa <- ggplot() +
  geom_sf(data=estados_sf, # Brazilian map
          fill=gray(0.85),
          color=gray(0.7)) +
  geom_sf(data=pontos_sf,
          alpha=0.7,
          aes(color=Preco),
          size=2.5,
          show.legend = 'point') +
  labs(title='Distribuição dos imóveis no Brasil')

mapa
										</code></pre>
										<h4 class="major">BRAZIL MAP 2 HERE</h4>

										And finally, to complement it, we can show the average rental price by state on the map:
										<pre><code>

# First it is necessary to unite the estados_sf dataframe with the anunciosg dataframe
options(scipen = 100) # Turning of the scientific notation

new.df <- merge(x=estados_sf, y=anunciosg,
                by.x ='postal', by.y='Estado', all=T)

# Creating discret intervals to the Price variable
breaks_media <- classIntervals(c(min(anunciosg$MediaPreco) - 0.00001, anunciosg$MediaPreco), n=7, style='quantile')

new.df <- mutate(new.df, MediaPrecoCat = cut(MediaPreco, breaks_media$brks))

# Changing the scientific notation
levels(new.df$MediaPrecoCat) <- c('(1000,1210]', '(1210,1390]', '(1390,1580]', '(1580,1780]',
                                  '(1780,2000]','(2000,2070]', '(2070,2850]')
mapa2 <- ggplot() +
  geom_sf(data=new.df,
          aes(fill=MediaPrecoCat)) +
          scale_fill_brewer(palette='OrRd') +
  labs(title='Média de preço por Estado',
       fill='Preço Médio')
mapa2
										</code></pre>
									<h4 class="major">BRAZIL MAP 3 HERE</h4>

									Proportion Map
										<pre><code>
# Proportion map
breaks_prop <- classIntervals(c(min(anunciosg$Proporcao) - 0.0000001, anunciosg$Proporcao), n=7, style='quantile')

new.df <- mutate(new.df, ProporcaoCat = cut(Proporcao, breaks_prop$brks))


mapa3 <- ggplot() +
  geom_sf(data=new.df,
          aes(fill=ProporcaoCat)) +
          scale_fill_brewer(palette='OrRd') +
  labs(title='Proporção entre aluguel e salário',
       fill='Proporção')
mapa3
										</code></pre>
									<h4 class="major">BRAZIL MAP 4 HERE</h4>

									</p>

									<h2 class="major">Vitae phasellus</h2>
									<p>Cras mattis ante fermentum, malesuada neque vitae, eleifend erat. Phasellus non pulvinar erat. Fusce tincidunt, nisl eget mattis egestas, purus ipsum consequat orci, sit amet lobortis lorem lacus in tellus. Sed ac elementum arcu. Quisque placerat auctor laoreet.</p>

									<section class="features">
										<article>
											<a href="#" class="image"><img src="images/pic04.jpg" alt="" /></a>
											<h3 class="major">Sed feugiat lorem</h3>
											<p>Lorem ipsum dolor sit amet, consectetur adipiscing vehicula id nulla dignissim dapibus ultrices.</p>
											<a href="#" class="special">Learn more</a>
										</article>
										<article>
											<a href="#" class="image"><img src="images/pic05.jpg" alt="" /></a>
											<h3 class="major">Nisl placerat</h3>
											<p>Lorem ipsum dolor sit amet, consectetur adipiscing vehicula id nulla dignissim dapibus ultrices.</p>
											<a href="#" class="special">Learn more</a>
										</article>
									</section>

								</div>
							</div>

					</section>

				<!-- Footer -->
					<section id="footer">
						<div class="inner">
							<h2 class="major">Get in touch</h2>
							<p>Cras mattis ante fermentum, malesuada neque vitae, eleifend erat. Phasellus non pulvinar erat. Fusce tincidunt, nisl eget mattis egestas, purus ipsum consequat orci, sit amet lobortis lorem lacus in tellus. Sed ac elementum arcu. Quisque placerat auctor laoreet.</p>
<!--							<form method="post" action="#">
								<div class="fields">
									<div class="field">
										<label for="name">Name</label>
										<input type="text" name="name" id="name" />
									</div>
									<div class="field">
										<label for="email">Email</label>
										<input type="email" name="email" id="email" />
									</div>
									<div class="field">
										<label for="message">Message</label>
										<textarea name="message" id="message" rows="4"></textarea>
									</div>
								</div>
								<ul class="actions">
									<li><input type="submit" value="Send Message" /></li>
								</ul>
							</form>-->
							<ul class="contact">
								<li class="icon solid fa-home">
									Vasco da Gama, Recife<br />
									Pernambuco, Brazil.
								</li>
								<li class="icon solid fa-phone">(+55) 08198480-2352</li>
								<li class="icon solid fa-envelope"><a href="#">michelarrudala@gmail.com</a></li>
								<!-- <li class="icon brands fa-twitter"><a href="#">twitter.com/untitled-tld</a></li> -->
								<li class="icon brands fa-linkedin"><a href="https://www.linkedin.com/in/michel-de-ara%C3%BAjo-947377197/">Linkedin</a></li>
								<!-- <li class="icon brands fa-instagram"><a href="#">instagram.com/untitled-tld</a></li> -->
							</ul>
							<ul class="copyright">
								<li>&copy; Michel de Araújo. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>